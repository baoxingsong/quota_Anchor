# 共线性文档

---

- [共线性文档](#共线性文档)
  - [最长路径算法](#最长路径算法)
    - [参数介绍](#参数介绍)

## 最长路径算法

### 参数介绍

```command
quota_Anchor col -h
```

```text
  -h, --help            展示帮助信息并退出。
  -c , --conf           命令行参数优先级大于配置文件参数优先级。
  -i , --input_file_name 
                        输入文件(表文件)。
  -o , --output_coll_name 
                        输出共线性文件。
  -r , --r_value        参考基因组最大比对深度。
  -q , --q_value        查询基因组最大比对深度。
  -s , --strict_strand 
                        共线性基因对的方向和共线性区块的方向是否严格相同或严格相反
                        (1:是;0:否. 默认: 1)。
  -a , --get_all_collinearity 
                        若设置为1, 该参数使得-r和-q参数无效并生成两物种间所有的共线性基因对(默认: 0)。 0: -q和-r参数有效，根据-r和-q参数确定共线性深度; 1 或者其他整数: 
                        -r和-q参数无效，产生两物种间所有的共线性基因对。
  -t , --count_style    指定-q和-r参数时，软件对共线性区块的基因的计数方式, 0: 仅对共线性区块内的共线性基因计数; 1 或者其他整数: 对区块内所有基因计数(默认: 0)。
  -m , --tandem_length 
                        这个参数仅仅在物种自己和自己比较的共线性过程中有效。 选项: 0 意味着保留串联重复基因对; 1 或者其他整数意味着移除在这个整数范围内的串联重复基因对(默认: 0)。在基于ks相对物种分化事件定位全基因组复制事件时，需设置该参数(例如 -m 500)。
  -W , --overlap_window 
                        指定允许的最大距离, 仅保留在该距离条件下最好的同源基因对用于共线性分析，具体可参考下方介绍(默认: 1)。
  -D , --maximum_gap_size 
                        参考和查询物种的相邻共线性基因间的间隙所允许的最大值 (默认: 25)。
  -I , --minimum_chain_score 
                        区块所允许的最小得分 (默认: 3)。
  -E , --gap_extend_penalty 
                        间隙扩展罚分 (默认: -0.005)。
  -f , --strict_remove_overlap 
                        是否移除一个共线性区块所构成的方形区域内的所有基因对来避免共线性区块重叠(1:是;0:否. 默认: 0)。
  -overwrite, --overwrite
                        如果输出文件存在的话，覆盖输出文件。
```

1. --input_file
    部分输入文件内容如下。该文件以制表符分隔，共13列，产生于`quota_Anchor pre_col`命令。文件从左往右，依次为，`参考物种基因名`， `参考物种染色体名`， `参考基因在染色体的位置` (从1开始, 依次为 1,2,3,4...), `参考基因的起始位置`(注意:这里我们使用的是gff文件中最长转录本的起始位置), `参考基因的终止位置`(注意:这里我们使用的是gff文件中最长转录本的终止位置),, `参考基因所在链`, `查询基因名`, `查询物种染色体名`, `查询基因在染色体上的位置`, `查询基因的起始位置`, `查询基因的终止位置`, `查询基因所在链`, `blast一致位置的百分比`(blast格式6输出文件的第三列， 该值除以100的商作为共线性过程的基因对的得分)。

   ```text
   gene:SORBI_3002G296100    2    3038    67310606    67314182    +    Zm00001eb000010    chr1    1    34722    38366    +    89.1
   gene:SORBI_3004G001400    4    13    122315    123614    -    Zm00001eb000020    chr1    2    41527    45913    -    60.0
   gene:SORBI_3002G280200    2    2870    66167219    66169042    -    Zm00001eb000020    chr1    2    41527    45913    -    61.5
   gene:SORBI_3007G139100    7    1460    56738045    56738551    +    Zm00001eb000020    chr1    2    41527    45913    -    55.8
   ```

2. --output_coll_name
    输出文件首行是运行命令, 第二行是列名，第三行起是共线性区块相关信息。 第三行，从左往右，依次为，`区块名` (从1开始), `共线性基因对的数量`, `区块得分`, `参考和查询染色体名` 和 `区块方向`(POSITIVE or NEGATIVE)。

    注:
    a)区块方向:
    `POSITIVE`: 参考基因和查询基因的位置均递增。
    `NEGATIVE`: 参考基因的位置递增，查询基因的位置递减。

    b)strand 列:
    `+`: 参考基因和查询基因位于相同的链上。
    `-`: 参考基因和查询基因位于相反的链上。

    ```text
    #anchorwave pro -i sb_zm.table -o sb_zm.collinearity -R 2 -Q 1 -D 25 -m 0 -W 1 -c 0 -s 0 -a 1 -I 3 -E -0.005 -f 0
    refGene    refChr    refId    referenceStart    referenceEnd    queryGene    queryChr    queryId    queryStart    queryEnd    strand    score
    ##Alignment    1    N=9    score=4.0115    10&chr2    POSITIVE
    gene:SORBI_3010G065500    10    667    5198737    5201677    Zm00001eb099470    chr2    3037    185608728    185611581    -    0.665
    gene:SORBI_3010G066100    10    673    5269692    5273369    Zm00001eb099640    chr2    3052    186946619    186952568    +    0.556
    gene:SORBI_3010G067300    10    685    5393094    5396312    Zm00001eb099720    chr2    3059    187379803    187383240    -    0.469
    gene:SORBI_3010G068600    10    700    5507755    5515138    Zm00001eb099810    chr2    3068 187672103    187679430    -    0.387
    ```

3. --r_value and --q_value
    `r_value`: 参考基因组最大比对深度。简单来说，该参数表示参考基因在共线性结果文件中最多出现的次数。
    `q_value`: 查询基因组最大比对深度，简单来说，该参数表示查询基因在共线性结果文件中最多出现的次数。

    注: 自从玉米和高粱分化以来，玉米相对高粱多经历了一次全基因组复制，随后的染色体融合等变异，导致了玉米和高粱染色体数量相同，都为10。若以高粱为参考，玉米为查询，可设置`r_value 2`和`q_value 1`。因而对于每个玉米基因最多允许一条共线性路径，而对于每个高粱基因最多允许两条共线性路径。

4. --strict_strand
    指定基因对的方向和共线性区块的方向是否严格相同或者相反(1： 是；0：否。默认: 1 )
    注:
    若设置`--strict_strand 1`，对于POSITIVE区块，除了要求参考基因位置和查询基因位置都递增外，还要求基因对的链为`+`，即参考基因所在链和查询基因所在链相同。对于NEGATIVE区块，除了要求参考基因位置递增、查询基因位置递减外，还要求基因对的链为`-`，即参考基因所在链和查询基因所在链相反。一定程度上去除了相对倒位的共线性基因对(如果共线性基因对和区块的方向相反，则将其称为相对倒位基因对)。

    若设置`--strict_strand 0`，对于POSITIVE区块，要求参考基因位置和查询基因位置都递增。对于NEGATIVE区块，要求参考基因位置递增，查询基因位置递减。这与 [DAGchainer](https://sourceforge.net/projects/dagchainer/)、[MCScanX](https://github.com/wyp1125/MCScanX) 和 [WGDI](https://github.com/SunPengChuan/wgdi) 类似。

5. --get_all_collinearity
    如果设置为1，则禁用-r和-q参数并获取所有共线结果（默认：0）。选项：0：启用-r -q参数；1或其他整数：禁用-r -q参数并获取所有共线结果。

    注：如果设置`--get_all_collinearity 1`，则无论是否设置`--r_value`和`q_value`，算法都会搜索所有共线性区块。理论上，也可以通过将-q -r设置为极大的值来获取所有共线区块，但运行速度非常慢。我们提供此选项目的是加快获取所有共线性区块的过程。

6. --tandem_length
    此参数仅对自身与自身共线性比对有效。选项：0 表示保留串联重复基因对；1 或任何其他整数表示删除串联重复长度短于指定整数值的基因对（默认值：0）。当基于ks相对物种分化事件定位全基因组复制事件时，需要设置此参数（例如 -m 500）

    注:
    1. 玉米和玉米自身比较的部分输入文件如下。软件会搜索参考基因名和查询基因名相同的基因对，一旦搜索到，软件会将query vs ref当作self vs self。仅在这种情况下参数`--tandem_length`才会生效，否则软件会忽略该参数。如果参考基因和查询基因位于同一条染色体上，并且`queryId - refId的绝对值`（`简写为abs(queryId - refId)`）小于或等于`--tandem_length`，软件会忽略该基因对。
    2. 如果设置了`--tandem_length 500`，但是参考基因名称不可能与查询基因名称相同(即ref vs query)，则该参数无用。

       ```text
       Zm00001eb000010    chr1    1    34722    38366    +    Zm00001eb000010    chr1    1    34722    38366    +    100.0
       Zm00001eb320340    chr7    1992    151457760    151461185    -    Zm00001eb000010    chr1    1    34722    38366    +    94.918
       Zm00001eb192920    chr4    2548    180976882    180978457    +    Zm00001eb000010    chr1    1    34722    38366    +    24.324
       Zm00001eb299540    chr7    139    4226770    4244226    +    Zm00001eb000010    chr1    1    34722    38366    +    25.786
       Zm00001eb246440    chr5    3279    185610728    185613090    +    Zm00001eb000010    chr1    1    34722    38366    +    27.547
       Zm00001eb349900    chr8    1579    110289798    110292975    -    Zm00001eb000010    chr1    1    34722    38366    +    20.544
       ```

7. --overlap_window
    指定所允许的最大距离，仅保留在该距离条件下的最佳同源基因对进行共线性分析（默认：1）。

    注:
    对于每对染色体（参考染色体 & 查询染色体）
    1. 对于一个查询基因，如果两个不同的参考基因可以与该查询基因匹配，并且两个参考基因距离满足 `abs(refId1 - refId2)` <= `--overlap_window`，则软件将保留具有最大 `pident` 的匹配并删除另一个匹配。
    2. 对于一个参考基因，如果两个不同的查询基因可以与该参考基因匹配，并且两个查询基因距离满足 `abs(queryId1 - queryId2)` <= `--overlap_window`，则软件将保留具有最大 `pident` 的匹配并删除另一个匹配。

8. --maximum_gap_size
    对于一个区块，两个相邻的基因对有一个所允许最大间隙的约束，即 `abs(refId1-refId2) - 1` <= `--maximum_gap_size` 和 `abs(queryId1-queryId2) - 1` <= `--maximum_gap_size`。
    (`abs(refId1-refId2) - 1` + `abs(queryId1-queryId2) - 1`) / 2 作为两个基因对（匹配）之间的距离。

9. --gap_extend_penalty
    若间隙不为零, 两个基因对(匹配)之间的 `gap_penalty` 等于 `gap_open_penalty + disatance * gap_extend_penalty`。

    注意:
    如果不仔细的调整参数，大多数基于基因和动态规划的共线性软件产生的共线性区块似乎经常在两端有一些匹配分数较低的基因对。如果你的参考物种和查询物种关系密切，并且你想获得更高质量的共线性区块，你可以将此值设置为 `-0.02`、`-0.03` 等，但不要太高，以免结果中没有任何基因对。
10. --minimum_chain_score
    共线性区块允许的最小得分（默认：3）。

    注:
    对于默认值 3，由于基因对的得分为`pident/100`（<=1），因此任何区块的共线性基因对的数量都将大于或等于 3。
11. --count_style
    使用-r -q 参数时，软件对已经识别到的区块中的基因的计数方式，0：仅计数区块内的共线性基因；1 或其他整数：计数区块内的所有基因。

    注:
    在--r_value参数设置为2，--q_value参数设置为1的条件下，若--count_style设置为1，以下图为例（每个参考基因最多使用两次，每个查询基因最多使用一次）。如果蓝色区域中虚线围成的方形区域对应的参考物种染色体区域所包含基因数小于或等于`--maximum_gap_size - 1`，且对应的查询物种染色体区域所包含基因数也小于或等于`--maximum_gap_size - 1`，则染色体a和染色体1之间的两个共线区域应为一个共线性区块，而不是两个共线性区块（如果`matchscore + gap_penalty` > 0的话）。这时软件会统计区块两端两个参考基因之间的所有基因，当然也会统计区块两端两个查询基因之间的所有基因。
    如果count_style设置为0，软件将只统计区块两端基因之间的共线性基因。
    <p align="center">
    <img src="../plots/count_style.png" alt= count_style.png width="800px" background-color="#ffffff" />
    </p>

12. --strict_remove_overlap
    指定是否需要严格去除某个共线性区块所围成的方形区域内的所有基因对以避免共线性区块的重叠。（1：是；0：否。默认: 0）。
    注:
    如果被比较的两条染色体内存在大量所谓的串联重复或近端重复基因，如下图所示，两条染色体之间可能存在大量共线性区域。如果将此参数设置为1，当软件根据共线性区块得分识别到一个得分最高的区块时，该区块对应的的两个(参考和查询)染色体区域所对应的两个基因集取笛卡尔积得到的基因对将被忽略，只保留这个区块本身。当使用该参数时，可能需要增加--gap_extend_penalty（例如-0.02或-0.03），进而减少共线性区块两端得分较低的基因对对结果造成的影响。
    一般情况下，`--overlap_window`参数的使用已经可以避免共线性区块的重叠，一般不需要设置该参数。
    <p align="center">
    <img src="../plots/tandem.png" alt= tandem.png width="800px" background-color="#ffffff" />
    </p>
